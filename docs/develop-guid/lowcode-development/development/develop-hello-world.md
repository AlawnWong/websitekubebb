---
sidebar_position: 4
---

# 发布组件

本章节主要介绍发布管理，即在云梯低码平台发布一个应用到 Kubebb 组件仓库。发布成功后，可进入 Kubebb 组件市场页面，查看应用或安装使用。

云梯低码平台发布一个应用的完整流程：新增应用 -> 创建分支 -> 新增页面 -> 设计页面 -> git 提交 -> 发布应用。 发布之前先设计一个应用，请参见[前端层基于低码 Kit 的开发](./frontend-low-code.md)。 发布管理包括两部分，应用发布和组件仓库管理。

## 组件仓库管理

:::tip

- 发布应用的前提，至少有一个组件仓库。部署云梯低码平台后，会默认部署一个组件仓库，此仓库适用于平台所有应用。
- 同时此仓库也默认添加到 Kubebb 的`组件仓库管理`中，低码应用发布后，直接可进入 Kubebb 的`组件市场`页面，查看应用或安装使用。详细参见[**组件市场**](user-guid/component_market.md)。
- 应用的维护者、拥有者有权限管理仓库。

:::

管理组件仓库操作如下:

1. 登录云梯低码平台，进入`应用管理`页面，找到目标应用，点击**应用名称**进入详情页面。
2. 切换顶部导航到**发布管理**，默认进入`发布记录`页面，切换到**组件仓库管理**页面。点击**添加组件仓库**，弹框配置参数说明如下：

- 组件仓库名称：`由3~63位字符、下划线“_”、中划线“-”或点“.”组成，并以字符开头或结尾`，应用内唯一。
- 勾选内置仓库，默认不勾选。仅系统管理员有权勾选。
- 仓库地址：输入http://ip(host):port/xxx。 示例`http://192.168.1.1:80/repository`
- 用户名、密码：非必填。默认是Basic Auth认证方式。

3. 点击**确定**，添加仓库成功后，展示已添加的仓库信息，包括组件仓库名称、当前状态、组件仓库地址、更新者、更新时间。

- 仓库状态：健康或异常，异常一般指当仓库自身数据获取更新失败。
- 更新者：最近一次修改仓库信息者

4. 编辑仓库时，仓库名称、是否内置不允许修改，其他可按需调整。
5. 删除仓库时，二次弹框提示是否“同步删除当前仓库的所有发布记录”，勾选后，点击**确定**，即删除仓库和其中所有应用的发布记录；反之，则仅删除仓库。

:::note

- 组件仓库目前支持添加 Chart Museum 类型的 helm 仓库。
- 部署云梯低码平台后，默认部署的组件仓库即为`内置仓库`类型，所有应用的`组件仓库管理`中可见可发布至此仓库。
- `内置仓库`仅系统管理员有权创建、删除。可创建多个内置仓库。
- 用户自行添加的组件仓库，需自行到 Kubebb 的`组件仓库管理`中添加。后续低码应用发布至此仓库后，才支持查看或安装。

:::

## 应用发布

:::tip

- 发布应用的前提，至少有一个组件仓库。参见[**组件仓库管理**](#组件仓库管理)。
- 应用的维护者、拥有者才有发布应用的权限。

:::

本章节主要介绍应用发布流程，操作步骤如下：

1. 登录云梯低码平台，进入`应用管理`页面，找到目标应用，点击**应用名称**进入详情页面。
2. 发布前检查：发布应用时不会包含未提交的修改，请在`Git 面板`中按需提交修改。

![overview](./images/git-commit.png)

3. 提交完成后，切换顶部导航到**发布管理**，默认进入`发布记录`页面，点击**发布应用**按钮，配置参数说明如下：

- 发布名称：只读展示应用名称（命名空间），其中应用名称即发布到组件仓库后的组件名称
- 发布基线：可选Branch（即分支名称）、CommitId。

  - 默认选中Branch，先选择分支名称，再级联选择 CommitId。选择 CommitId 时，同步展示提交内容和时间。
  - 选择 CommitId，手动输入 CommitId。

- 发布至仓库：默认填充列表中第一个仓库，按需选择。
- 发布版本：填写版本号，例0.0.1。`由50位字母、数字、点"."、中划线"-"或加号"+" 组成，且必须以数字开头，以数字或字母结尾`。仅支持 a.b.c 格式。

4. 点击**确定**，开始发布。列表中展示此条发布记录。包括发布名称、发布基线、发布状态、发布版本、组件仓库管理、组件仓库状态、组件仓库地址、发布者、发布时间、操作：删除。

![overview](./images/app-publish.png)

- 发布名称：应用名称（命名空间名称）。
- 发布基线：展示分支名称（CommitId）或者 CommitId。hover展示详细信息，包括提交人、提交时间、提交信息。
- 发布状态：发布中、发布成功、发布失败。

  - 发布中：展示发布进度。
  - 发布成功：即可进入 Kubebb [**组件市场**](user-guid/component_market.md)，查看应用或安装使用。
  - 发布失败：hover可展示流水线ID和失败原因，便于用户快速定位问题。

- 发布版本：本次发布的应用版本。
- 组件仓库名称、组件仓库状态、组件仓库地址：本次发布所选仓库的信息。
- 发布者：本次发布的发布人员。
- 发布时间：默认降序排列。

4. 点击**删除**，仅删除低码平台侧的相关发布数据，不影响其在 Kubebb `组件市场`的使用。


:::note
同一组件仓库中，同一应用每次发布时，版本号不能相同。
:::